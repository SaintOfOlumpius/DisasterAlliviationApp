# Reusable template for build and test tasks
parameters:
  - name: buildConfiguration
    default: 'Release'
  - name: solutionPath
    default: '**/*.sln'
  - name: testProjectPath
    default: '**/*Tests.csproj'

steps:
- task: UseDotNet@2
  displayName: 'Use .NET 8.0 SDK'
  inputs:
    packageType: 'sdk'
    version: '8.0.x'
    includePreviewVersions: false

- task: DotNetCoreCLI@2
  displayName: 'Restore dependencies'
  inputs:
    command: 'restore'
    projects: '${{ parameters.solutionPath }}'

- task: DotNetCoreCLI@2
  displayName: 'Build solution'
  inputs:
    command: 'build'
    projects: '${{ parameters.solutionPath }}'
    arguments: '--configuration ${{ parameters.buildConfiguration }} --no-restore'

- task: DotNetCoreCLI@2
  displayName: 'Run tests with code coverage'
  inputs:
    command: 'test'
    projects: '${{ parameters.testProjectPath }}'
    arguments: |
      --configuration ${{ parameters.buildConfiguration }}
      --no-build
      --collect:"XPlat Code Coverage"
      --results-directory $(Agent.TempDirectory)/TestResults
      --logger "trx;LogFileName=test-results.trx"
      --logger "junit;LogFileName=test-results.xml"
      -- DataCollectionRunSettings.DataCollectors.DataCollector.Configuration.Format=cobertura

